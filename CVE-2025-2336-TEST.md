# CVE-2025-2336 Fix Verification

## Vulnerability Details
CVE-2025-2336 is an improper sanitization vulnerability affecting SVG `<image>` elements with `href` and `xlink:href` attributes in AngularJS ngSanitize module.

## The Vulnerability

### Problem
The sanitization code only checked for HTML `<img>` elements when determining if a URI attribute should be validated as an image source:

```javascript
var isImage = (tag === 'img' && lkey === 'src') || (lkey === 'background');
```

This meant that SVG `<image>` elements with `href` or `xlink:href` attributes were NOT treated as image sources, allowing them to bypass image source restrictions.

### Impact
Attackers could:
1. **Content Spoofing**: Inject malicious SVG images to spoof content
2. **Performance DoS**: Load extremely large or slow-loading images
3. **CSP Bypass**: Bypass Content Security Policy restrictions on image sources
4. **Privacy Leaks**: Reference external images to track users

## The Fix

### Code Change
Updated the `isImage` check to include SVG `<image>` elements:

**Before (Vulnerable):**
```javascript
var isImage = (tag === 'img' && lkey === 'src') || (lkey === 'background');
```

**After (Secure):**
```javascript
var isImage = (tag === 'img' && lkey === 'src') || (lkey === 'background') ||
              (tag === 'image' && (lkey === 'href' || lkey === 'xlink:href'));
```

### How It Works
Now the sanitizer properly identifies SVG `<image>` elements with `href` or `xlink:href` attributes as image sources and applies the same URI validation that is used for HTML images. This ensures:

1. The URI is validated through the `uriValidator` function
2. Unsafe URIs (e.g., `javascript:` URLs) are blocked
3. Image source restrictions are consistently applied
4. CSP policies are respected

## Testing the Fix

### Vulnerable Patterns (Now Fixed)
These SVG patterns would have bypassed image source validation:

```html
<!-- SVG image with href -->
<svg><image href="http://malicious.com/large.png" /></svg>

<!-- SVG image with xlink:href -->
<svg><image xlink:href="http://attacker.com/track.png" /></svg>

<!-- SVG image with javascript: URL (would be blocked anyway, but now properly checked) -->
<svg><image href="javascript:alert('XSS')" /></svg>
```

### Expected Behavior After Fix
- SVG `<image>` elements with `href` or `xlink:href` are now subject to image source validation
- The `$$sanitizeUri` function validates these URIs just like HTML image sources
- Unsafe URIs are properly rejected
- Image source restrictions apply consistently across HTML and SVG

## Requirements

The fix requires that:
1. SVG support is enabled via `$sanitizeProvider.enableSvg(true)`
2. The `$$sanitizeUri` service is properly configured
3. Any custom image source whitelists include SVG image URIs

## Impact

- **Severity**: Medium
- **Attack Vector**: Malicious SVG content with image elements
- **Impact**: Content spoofing, performance degradation, CSP bypass
- **Fixed in**: Version 1.5.8 (patched)

## References
- [CVE-2025-2336](https://nvd.nist.gov/vuln/detail/CVE-2025-2336)
- [HeroDevs Vulnerability Directory](https://www.herodevs.com/vulnerability-directory/cve-2025-2336)
- [Snyk Security Advisory](https://security.snyk.io/vuln/SNYK-JS-ANGULARSANITIZE-10337224)

