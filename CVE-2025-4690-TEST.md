# CVE-2025-4690 Fix Verification

## Vulnerability Details
CVE-2025-4690 is a Regular Expression Denial of Service (ReDoS) vulnerability in the `linky` filter.

## The Fix
Changed the vulnerable regex pattern from:
```javascript
/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i
```

To the secure version:
```javascript
/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)[\S]+?[^\s.;,(){}<>"\u201d\u2019]/i
```

## Key Changes
- **Before**: `\S*` (greedy quantifier - zero or more non-whitespace chars)
- **After**: `[\S]+?` (non-greedy/lazy quantifier - one or more non-whitespace chars, minimal match)

## Why This Fixes the Issue
The original pattern used `\S*` followed by a negated character class. When the regex failed to match, it would try all possible ways to split characters between these two parts (catastrophic backtracking).

The non-greedy quantifier `+?` matches the minimum necessary characters and stops as soon as the next part can match, preventing excessive backtracking.

## Testing the Fix

### Vulnerable Input Example
Strings like these would cause excessive backtracking with the old regex:
```
http://aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!
mailto:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!
www.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa!
```

The vulnerability occurs when there are many characters that match `\S` but the final character doesn't match the negated character class `[^\s.;,(){}<>"\u201d\u2019]`.

### Testing Methodology
To verify the fix works:

1. **Performance Test**: The new regex should complete quickly even with malicious input
2. **Functionality Test**: Normal URL detection should still work correctly

Example test URLs that should still work:
- `http://example.com`
- `https://example.com/path`
- `mailto:user@example.com`
- `www.example.com`
- `ftp://files.example.com`

## Impact
- **Severity**: Medium
- **Attack Vector**: Providing crafted input to the linky filter
- **Impact**: Denial of Service through CPU exhaustion
- **Fixed in**: Version 1.5.9

## References
- [NVD CVE-2025-4690](https://nvd.nist.gov/vuln/detail/CVE-2025-4690)
- [HeroDevs Vulnerability Directory](https://www.herodevs.com/vulnerability-directory/cve-2025-4690)

